<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>„Ç≠„É©„Ç≠„É©ÔºÅ„Åï„Çì„Åô„ÅÜ„Éâ„É™„É´ DX</title>
	<style>
		:root {
			--primary-color: #ff6b6b; /* C„Éú„Çø„É≥„ÉªÊ∂àÂéªÁ≥ª */
			--secondary-color: #4ecdc4; /* Ê±∫ÂÆö„Éú„Çø„É≥„ÉªÁ∑ë */
			--accent-color: #feca57;
			--multi-color: #a29bfe;
			--div-color: #ff9f43;
			--bg-color: #f0f4f8;
		}

		body {
			font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
			background-color: var(--bg-color);
			margin: 0;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			touch-action: manipulation;
			overflow: hidden;
		}

		#app {
			background: white;
			width: 95%;
			max-width: 420px;
			padding: 15px;
			border-radius: 30px;
			box-shadow: 0 15px 35px rgba(0,0,0,0.1);
			text-align: center;
			border: 6px solid var(--secondary-color);
			position: relative;
		}

		.mode-selector {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 5px;
			margin-bottom: 15px;
		}

		.mode-btn {
			padding: 10px 2px;
			border-radius: 12px;
			border: 2px solid #eee;
			background: white;
			cursor: pointer;
			font-weight: bold;
			font-size: 0.8rem;
			transition: 0.2s;
		}

		.mode-btn.active { color: white; border-color: transparent; transform: scale(1.05); }
		#mode-plus.active { background: #ff8787; }
		#mode-minus.active { background: #63e6be; }
		#mode-multi.active { background: var(--multi-color); }
		#mode-div.active { background: var(--div-color); }

		.stats { display: flex; justify-content: space-between; font-weight: bold; color: #666; margin-bottom: 5px; padding: 0 10px; }

		.question-area {
			font-size: 3.5rem;
			margin: 15px 0;
			font-weight: 900;
			color: #333;
			min-height: 85px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.input-display {
			font-size: 3rem;
			height: 70px;
			line-height: 70px;
			background: #f9f9f9;
			border-radius: 15px;
			margin-bottom: 15px;
			border-bottom: 5px solid #ddd;
			color: #333;
			font-weight: bold;
		}

		.numpad {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
		}

		button {
			padding: 15px;
			font-size: 1.6rem;
			border: none;
			border-radius: 18px;
			background: #fff;
			box-shadow: 0 4px 0 #ddd;
			cursor: pointer;
			transition: 0.1s;
		}

		button:active { transform: translateY(4px); box-shadow: none; }

		.btn-number { border: 1px solid #eee; }
		
		/* Á≠î„Åà„Çã„Éú„Çø„É≥„Å®C„Éú„Çø„É≥„ÅÆËâ≤ */
		.btn-enter { background: var(--secondary-color); color: white; grid-column: span 2; box-shadow: 0 4px 0 #3db8af; }
		.btn-clear { background: var(--primary-color); color: white; box-shadow: 0 4px 0 #e65b5b; }

		.particle { position: absolute; pointer-events: none; z-index: 100; }

		.result-screen { display: none; }
		.result-screen h2 { color: var(--primary-color); font-size: 2rem; }
	</style>
</head>
<body>

<div id="app">
	<div id="game-screen">
		<div class="mode-selector">
			<button class="mode-btn active" id="mode-plus" onclick="setMode('plus')">Ôºã</button>
			<button class="mode-btn" id="mode-minus" onclick="setMode('minus')">Ôºç</button>
			<button class="mode-btn" id="mode-multi" onclick="setMode('multi')">√ó</button>
			<button class="mode-btn" id="mode-div" onclick="setMode('div')">√∑</button>
		</div>

		<div class="stats">
			<span>„ÅÆ„Åì„Çä: <span id="remaining">10</span></span>
			<span>„Åõ„ÅÑ„Åã„ÅÑ: <span id="score">0</span></span>
		</div>

		<div class="question-area" id="question">?</div>
		<div class="input-display" id="answer-input"></div>

		<div class="numpad">
			<button class="btn-number" onclick="addNum(1)">1</button>
			<button class="btn-number" onclick="addNum(2)">2</button>
			<button class="btn-number" onclick="addNum(3)">3</button>
			<button class="btn-number" onclick="addNum(4)">4</button>
			<button class="btn-number" onclick="addNum(5)">5</button>
			<button class="btn-number" onclick="addNum(6)">6</button>
			<button class="btn-number" onclick="addNum(7)">7</button>
			<button class="btn-number" onclick="addNum(8)">8</button>
			<button class="btn-number" onclick="addNum(9)">9</button>
			<button class="btn-clear" onclick="clearInput()">C</button>
			<button class="btn-number" onclick="addNum(0)">0</button>
			<button class="btn-enter" onclick="checkAnswer()">„Åì„Åü„Åà„ÇãÔºÅ</button>
		</div>
	</div>

	<div id="result-screen" class="result-screen">
		<h2 id="result-title">üéâ „Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ üéâ</h2>
		<p id="final-score" style="font-size: 1.5rem; font-weight: bold;"></p>
		<button onclick="location.reload()" style="background: var(--secondary-color); color:white; width:100%; box-shadow: 0 4px 0 #3db8af;">„ÇÇ„ÅÜ„ÅÑ„Å°„Å© „ÇÑ„ÇãÔºÅ</button>
	</div>
</div>

<script>
	let num1, num2, correctAnswer, mode = 'plus';
	let score = 0, count = 0, maxQuestions = 10;
	let currentInput = "";
	let audioCtx = null;

	// Èü≥Â£∞„ÇíÂàùÊúüÂåñ„Åô„ÇãÈñ¢Êï∞ÔºàÊúÄÂàù„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅßÁô∫ÂãïÔºâ
	function initAudio() {
		if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
	}

	function setMode(newMode) {
		initAudio();
		mode = newMode;
		document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
		document.getElementById(`mode-${mode}`).classList.add('active');
		resetGame();
	}

	function resetGame() {
		score = 0; count = 0; currentInput = "";
		document.getElementById('score').innerText = "0";
		document.getElementById('remaining').innerText = maxQuestions;
		generateQuestion();
	}

	function generateQuestion() {
		currentInput = "";
		updateDisplay();
		
		let qText = "";
		if (mode === 'plus') {
			num1 = Math.floor(Math.random() * 9) + 1;
			num2 = Math.floor(Math.random() * 9) + 1;
			correctAnswer = num1 + num2;
			qText = `${num1} + ${num2}`;
		} else if (mode === 'minus') {
			num1 = Math.floor(Math.random() * 15) + 5;
			num2 = Math.floor(Math.random() * (num1 - 1)) + 1;
			correctAnswer = num1 - num2;
			qText = `${num1} - ${num2}`;
		} else if (mode === 'multi') {
			num1 = Math.floor(Math.random() * 9) + 1;
			num2 = Math.floor(Math.random() * 9) + 1;
			correctAnswer = num1 * num2;
			qText = `${num1} √ó ${num2}`;
		} else if (mode === 'div') {
			const ans = Math.floor(Math.random() * 9) + 1;
			num2 = Math.floor(Math.random() * 8) + 2;
			num1 = ans * num2;
			correctAnswer = ans;
			qText = `${num1} √∑ ${num2}`;
		}
		document.getElementById('question').innerText = qText;
	}

	function addNum(n) {
		initAudio();
		if (currentInput.length < 3) {
			currentInput += n;
			updateDisplay();
		}
	}

	function clearInput() {
		currentInput = "";
		updateDisplay();
	}

	function updateDisplay() {
		document.getElementById('answer-input').innerText = currentInput;
	}

	function checkAnswer() {
		if (currentInput === "") return;
		const userAnswer = parseInt(currentInput);

		if (userAnswer === correctAnswer) {
			playSuccessSound();
			createSparkles();
			score++;
		} else {
			playErrorSound();
		}
		
		count++;
		document.getElementById('score').innerText = score;
		document.getElementById('remaining').innerText = maxQuestions - count;

		if (count < maxQuestions) {
			setTimeout(generateQuestion, 500);
		} else {
			setTimeout(showResult, 600);
		}
	}

	// Ê≠£Ëß£„ÅÆÈü≥
	function playSuccessSound() {
		if (!audioCtx) return;
		const osc = audioCtx.createOscillator();
		const gain = audioCtx.createGain();
		osc.type = 'sine';
		osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
		osc.frequency.exponentialRampToValueAtTime(1046.50, audioCtx.currentTime + 0.1); // C6
		gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
		gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
		osc.connect(gain);
		gain.connect(audioCtx.destination);
		osc.start();
		osc.stop(audioCtx.currentTime + 0.3);
	}

	// ‰∏çÊ≠£Ëß£„ÅÆÈü≥
	function playErrorSound() {
		if (!audioCtx) return;
		const osc = audioCtx.createOscillator();
		const gain = audioCtx.createGain();
		osc.type = 'triangle';
		osc.frequency.setValueAtTime(180, audioCtx.currentTime);
		gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
		gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
		osc.connect(gain);
		gain.connect(audioCtx.destination);
		osc.start();
		osc.stop(audioCtx.currentTime + 0.2);
	}

	function createSparkles() {
		const emojis = ['‚ú®', 'üåü', 'üç≠', 'üåà', 'üíé', 'üç¶'];
		for (let i = 0; i < 25; i++) {
			const particle = document.createElement('div');
			particle.className = 'particle';
			particle.innerText = emojis[Math.floor(Math.random() * emojis.length)];
			particle.style.left = '50%';
			particle.style.top = '40%';
			particle.style.fontSize = (Math.random() * 20 + 25) + 'px';
			document.body.appendChild(particle);

			const dX = (Math.random() - 0.5) * 600;
			const dY = (Math.random() - 0.5) * 600;

			particle.animate([
				{ transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
				{ transform: `translate(${dX}px, ${dY}px) scale(0) rotate(720deg)`, opacity: 0 }
			], { duration: 1000, easing: 'ease-out' }).onfinish = () => particle.remove();
		}
	}

	function showResult() {
		document.getElementById('game-screen').style.display = 'none';
		document.getElementById('result-screen').style.display = 'block';
		const title = score === maxQuestions ? "üéâ „Åú„Çì„ÇÇ„Çì„Åõ„ÅÑ„Åã„ÅÑÔºÅ üéâ" : "üéâ „Çà„Åè„Åå„Çì„Å∞„Å£„Åü„Å≠ÔºÅ üéâ";
		document.getElementById('result-title').innerText = title;
		document.getElementById('final-score').innerText = `${maxQuestions}„ÇÇ„Çì‰∏≠ ${score}„ÇÇ„Çì „Åõ„ÅÑ„Åã„ÅÑÔºÅ`;
	}

	generateQuestion();
</script>
</body>
</html>
